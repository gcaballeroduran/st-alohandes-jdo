--- Sentencias SQL para la creación del esquema de parranderos
--- Las tablas tienen prefijo A_ para facilitar su acceso desde SQL Developer

-- USO
-- Copie el contenido de este archivo en una pestaña SQL de SQL Developer
-- Ejecútelo como un script - Utilice el botón correspondiente de la pestaña utilizada

-- Creación del secuenciador
create sequence alohandes_sequence;

-- Creación de la tabla USUARIO y especificación de sus restricciones
CREATE TABLE A_USUARIO
   (ID NUMBER, 
    TIPOID VARCHAR2(255 BYTE),
    LOGIN VARCHAR2(255 BYTE), 
    RELACIONU VARCHAR2(255 BYTE),
    CONSTRAINT A_USUARIO_PK PRIMARY KEY (LOGIN));
	
ALTER TABLE A_USUARIO
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

ALTER TABLE A_USUARIO
	ADD CONSTRAINT CS_U_TIPOID 
	CHECK (TIPOID IN ('CARNET_U', 'CEDULA', 'PASAPORTE'))
ENABLE;

ALTER TABLE A_USUARIO
	ADD CONSTRAINT UN_LOGIN 
	UNIQUE (LOGIN)
ENABLE;

-- Creación de la tabla OPERADOR y especificación de sus restricciones
CREATE TABLE A_OPERADOR
   (ID VARCHAR(255 BYTE),
    NUMERO_RNT NUMBER,
    VENCIMIENTO_RNT DATE,
    REGISTRO_SUPER_TURISMO VARCHAR(255 BYTE),
    VENCIMIENTO_REGISTRO_ST DATE,
    CATEGORIA VARCHAR(255 BYTE),
    DIRECCION VARCHAR(511 BYTE),
    HORA_APERTURA DATE,
    HORA_CIERRE DATE,
    TIEMPO_MINIMO NUMBER,
    GANANCIA_ANIO_ACTUAL NUMBER,
    GANANCIA_ANIO_CORRIDO NUMBER,
    CONSTRAINT A_OPERADOR_PK PRIMARY KEY (ID));

ALTER TABLE A_OPERADOR
	ADD CONSTRAINT FK_V_USUARIO
        FOREIGN KEY (LOGIN)
	REFERENCES A_USUARIO(LOGIN)
ENABLE;

ALTER TABLE A_OPERADOR
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

ALTER TABLE A_OPERADOR
	ADD CONSTRAINT UN_NUMERO_RNT 
	UNIQUE (NUMERO_RNT)
ENABLE;

ALTER TABLE A_OPERADOR
	ADD CONSTRAINT CK_CATEGORIA
	CHECK (CATEGORIA IN ('HOTEL', 'HOSTAL', 'P_NATURAL', 'APARTAMENTO', 'VECINOS', 'VIVIENDA_U'))
ENABLE;

ALTER TABLE A_OPERADOR
	ADD CONSTRAINT CS_TIEMPO_MINIMO 
	CHECK (TIEMPO_MINIMO > 0)
ENABLE;

-- Creación de la tabla CLIENTE y especificación de sus restricciones
CREATE TABLE A_CLIENTE
   (ID VARCHAR(255 BYTE), 
    MEDIO_PAGO VARCHAR(255 BYTES),
    CONSTRAINT A_CLIENTE_PK PRIMARY KEY (ID));
	
ALTER TABLE A_OPERADOR
	ADD CONSTRAINT FK_V_USUARIO
        FOREIGN KEY (LOGIN)
	REFERENCES A_USUARIO(LOGIN)
ENABLE;

ALTER TABLE A_CLIENTE
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

-- Creación de la tabla PROPIEDAD y especificación de sus restricciones

CREATE TABLE A_PROPIEDAD
   (ID NUMBER, 
	CAPACIDAD NUMBER, 
	PRECIO NUMBER, 
	TAMANIO NUMBER, 
	DIAS_RESERVADOS NUMBER, 
	FECHA_CREACION DATE, 
	PISO NUMBER,
    HABILITADA NUMBER(1,0),
    OPERADOR VARCHAR(255 BYTE)
	 CONSTRAINT A_PROPIEDAD_PK PRIMARY KEY (ID) 
     );
     
ALTER TABLE A_PROPIEDAD
	ADD CONSTRAINT FK_V_USUARIO
        FOREIGN KEY (OPERADOR)
	REFERENCES A_USUARIO(LOGIN)
ENABLE;

ALTER TABLE A_PROPIEDAD
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

ALTER TABLE A_PROPIEDAD
	ADD CONSTRAINT CK_CAPACIDAD 
	CHECK (CAPACIDAD > 0)
ENABLE;

ALTER TABLE A_PROPIEDAD
	ADD CONSTRAINT CK_PRECIO
	CHECK (PRECIO > 0)
ENABLE;

ALTER TABLE A_PROPIEDAD
	ADD CONSTRAINT CK_TAMANIO
	CHECK (TAMANIO > 0)
ENABLE;

-- Creación de la tabla HABITACION y especificación de sus restricciones
 CREATE TABLE  A_HABITACION
   (ID NUMBER, 
	TIPO NUMBER(0,1,2), 
	INDIVIDUAL NUMBER(1,0), 
	ESQUEMA VARCHAR2(250 BYTE), 
    OPERADOR VARCHAR()255 BYTE),
	 CONSTRAINT A_HABITACION_PK PRIMARY KEY (ID) 
     );
     
ALTER TABLE A_HABITACION
	ADD CONSTRAINT FK_V_USUARIO
        FOREIGN KEY (OPERADOR)
	REFERENCES A_USUARIO(LOGIN)
ENABLE;

ALTER TABLE A_HABITACION
	ADD CONSTRAINT FK_V_PROPIEDAD
        FOREIGN KEY (ID)
	REFERENCES A_PROPIEDAD(ID)
ENABLE;

ALTER TABLE A_HABITACION
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

-- Creación de la tabla APARTAMENTO y especificación de sus restricciones
CREATE TABLE "A_APARTAMENTO" 
   (ID NUMBER, 
	AMUEBLADO NUMBER(1,0), 
	HABITACIONES NUMBER, 
	DESCRIPCION_MENAJE VARCHAR2(250 BYTE), 
	DESCRIPCION_SEGURO VARCHAR2(250 BYTE), 
	TIENE_SEGURO NUMBER(1,0),
    OPERADOR VARCHAR()255 BYTE),
	CONSTRAINT A_APARTAMENTO_PK PRIMARY KEY (ID)
   );
   
ALTER TABLE A_APARTAMENTO
	ADD CONSTRAINT FK_V_USUARIO
        FOREIGN KEY (OPERADOR)
	REFERENCES A_USUARIO(LOGIN)
ENABLE;
   
ALTER TABLE A_APARTAMENTO
	ADD CONSTRAINT FK_V_PROPIEDAD
        FOREIGN KEY (ID)
	REFERENCES A_PROPIEDAD(ID)
ENABLE;

ALTER TABLE A_APARTAMENTO
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

ALTER TABLE A_APARTAMENTO
	ADD CONSTRAINT CK_HABITACIONES 
	CHECK (HABITACIONES > 0)
ENABLE;

-- Creación de la tabla SERVICIO y especificación de sus restricciones
CREATE TABLE A_SERVICIO 
   (	
     ID NUMBER, 
	TIPO VARCHAR2(250 BYTE), 
	PRECIO NUMBER, 
	INTERVALO_PAGO NUMBER,
    PROPIEDAD NUMBER,
    CONSTRAINT A_SERVICIO_PK PRIMARY KEY (ID),
    );

ALTER TABLE A_SERVICIO
	ADD CONSTRAINT FK_V_PROPIEDAD
        FOREIGN KEY (PROPIEDAD)
	REFERENCES A_PROPIEDAD(ID)
ENABLE;

ALTER TABLE A_SERVICIO
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

ALTER TABLE A_SERVICIO
	ADD CONSTRAINT CK_PRECIO
	CHECK (PRECIO >= 0)
ENABLE;

-- Creaación de la tabla RESERVA COLECTIVA y especificación de sus restricciones
CREATE TABLE A_RESERVACOLECTIVA
   (ID NUMBER, 
    FECHA_INICIO DATE,
    DURACION NUMBER,
    CANTIDAD NUMBER,
    TIPO DATE,
    CLIENTE VARCHAR(255 BYTE)
    CONSTRAINT A_RESERVA_PK PRIMARY KEY (ID)
    );
	
ALTER TABLE A_RESERVACOLECTIVA
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

ALTER TABLE A_RESERVACOLECTIVA
	ADD CONSTRAINT CK_CANTIDAD
	CHECK (CANTIDAD > 0)
ENABLE;

ALTER TABLE A_RESERVACOLECTIVA
	ADD CONSTRAINT FK_V_CLIENTE
        FOREIGN KEY (CLIENTE)
	REFERENCES A_CLIENTE(ID)
ENABLE;

-- Creaación de la tabla RESERVA y especificación de sus restricciones
CREATE TABLE A_RESERVA
   (ID NUMBER, 
    FECHA_INICIO DATE,
    FECHA_FIN DATE,
    PERSONAS NUMBER,
    FIN_CANCELACION_OPORTUNA DATE,
    PORCENTAJE_A_PAGAR NUMBER,
    MONTO_TOTAL NUMBER,
    PROPIEDAD NUMBER,
    COLECTIVA NUMBER,
    CONSTRAINT A_RESERVA_PK PRIMARY KEY (ID));
	
ALTER TABLE A_RESERVA
	ADD CONSTRAINT UN_ID 
	UNIQUE (ID)
ENABLE;

ALTER TABLE A_RESERVA
	ADD CONSTRAINT CK_PERSONAS
	CHECK (PERSONAS > 0)
ENABLE;

ALTER TABLE A_RESERVA
	ADD CONSTRAINT FK_V_PROPIEDAD
        FOREIGN KEY (PROPIEDAD)
	REFERENCES A_PROPIEDAD(ID)
ENABLE;

ALTER TABLE A_RESERVA
	ADD CONSTRAINT FK_V_RESERVACOLECTIVA
        FOREIGN KEY (COLECTIVA)
	REFERENCES A_RESERVACOLECTIVA(ID)
ENABLE;

-- Creaación de la tabla RESERVAAPARTAMENTO y especificación de sus restricciones
CREATE TABLE A_RESERVAAPARTAMENTO
  (ID_APARTAMENTO NUMBER,
   ID_RESERVA NUMBER,
   CONSTRAINT A_RESERVA_PK PRIMARY KEY (ID_APARTAMENTO, ID_RESERVA)
   );

ALTER TABLE A_RESERVAAPARTAMENTO
ADD CONSTRAINT FK_V_APARTAMENTO
    FOREIGN KEY (ID_APARTAMENTO)
    REFERENCES A_APARTAMENTO(ID)
ENABLE;

ALTER TABLE A_RESERVAAPARTAMENTO
ADD CONSTRAINT FK_V_RESERVA
    FOREIGN KEY (ID_RESERVA)
    REFERENCES A_RESERVA(ID)
ENABLE;

-- Creación de la tabla RESERVAHABITACION y especificación de sus restricciones
CREATE TABLE A_RESERVAHABITACION
  (
  ID_HABITACION NUMBER,
   ID_RESERVA NUMBER,
  CONSTRAINT A_RESERVA_PK PRIMARY KEY (ID_HABITACION, ID_RESERVA)
  );

ALTER TABLE A_RESERVAHABITACION
ADD CONSTRAINT FK_V_HABITACION
    FOREIGN KEY (ID_HABITACION)
    REFERENCES A_HABITACION(ID)
ENABLE;

ALTER TABLE A_RESERVAHABITACION
ADD CONSTRAINT FK_V_RESERVA
    FOREIGN KEY (ID_RESERVA)
    REFERENCES A_RESERVA(ID)
ENABLE;

